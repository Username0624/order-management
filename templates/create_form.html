<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ºç«‹æ–°è¡¨å–®</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJ8uR2gII9oMvW14jWc//Y4/l86iM/8U8/51L6I6w1YtJ5P5w5/2F/1L6W1P5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> 
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid container-xl">
            <a class="navbar-brand fw-bold" href="{{ url_for('dashboard_page') }}">ğŸ›’ è¨‚å–®ç®¡ç†ç³»çµ±</a>
            <span class="navbar-text text-white">å»ºç«‹æ–°è¡¨å–®</span>
        </div>
    </nav>
    
    <div class="container-xl mt-4 mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                
                <h2 class="mb-4 text-center">ğŸ“‹ å»ºç«‹æ–°è¡¨å–®</h2>

                <form id="createForm">
                    
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <h4 class="mb-0"><i class="fas fa-info-circle me-2"></i> åŸºæœ¬è³‡è¨Š</h4>
                        </div>
                        <div class="card-body">
                            
                            <div class="mb-3">
                                <label for="title" class="form-label fw-bold">è¡¨å–®åç¨± <span class="text-danger">*</span></label>
                                <input id="title" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šåœ˜è³¼å•†å“è¨‚å–®è¡¨å–® 2024/Q3" required>
                            </div>

                            <div class="mb-3">
                                <label for="description" class="form-label fw-bold">è¡¨å–®ç°¡ä»‹ (å¯é¸)</label>
                                <textarea id="description" class="form-control" rows="3" placeholder="ç°¡çŸ­æè¿°è¡¨å–®çš„ç”¨é€”æˆ–æ³¨æ„äº‹é …ã€‚"></textarea>
                            </div>

                        </div>
                    </div>
                    
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <h4 class="mb-0"><i class="fas fa-list-check me-2"></i> å•Ÿç”¨åŠŸèƒ½/æ¬„ä½é¸é …</h4>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-3">è«‹é¸æ“‡è¦åœ¨è¨‚å–®ä¸­å•Ÿç”¨çš„å¯é¸æ¬„ä½ã€‚ï¼ˆè²·å®¶å§“åã€é›»è©±ã€åœ°å€ã€å•†å“æ¸…å–®ç‚ºå¿…å¡«æ¬„ä½ï¼‰</p>

                            <div class="row row-cols-1 row-cols-md-2 g-3">
                                
                                <div class="col">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="f_remittance">
                                        <label class="form-check-label" for="f_remittance">
                                            æ˜¯å¦å•Ÿç”¨ **åŒ¯æ¬¾ç‹€æ…‹** è¿½è¹¤
                                            <span class="text-muted small">(checkbox)</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="f_shipped">
                                        <label class="form-check-label" for="f_shipped">
                                            æ˜¯å¦å•Ÿç”¨ **å‡ºè²¨ç‹€æ…‹** è¿½è¹¤
                                            <span class="text-muted small">(å‡ºè²¨æ™‚æœƒè¨˜éŒ„æ—¥æœŸ)</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="f_shipping_fee">
                                        <label class="form-check-label" for="f_shipping_fee">
                                            æ˜¯å¦å•Ÿç”¨ **é‹è²»** æ¬„ä½
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="f_merge_shipping">
                                        <label class="form-check-label" for="f_merge_shipping">
                                            é‹è²» **ä½µå…¥åŒ¯æ¬¾ç¸½é¡** è¨ˆç®—
                                        </label>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="f_buyer_social">
                                        <label class="form-check-label" for="f_buyer_social">
                                            æ˜¯å¦å•Ÿç”¨ **è²·å®¶ç¤¾ç¾¤** æ¬„ä½
                                            <span class="text-danger small">(åƒ…è³£å®¶å¯è¦‹)</span>
                                        </label>
                                    </div>
                                </div>
                                
                            </div> 
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <button type="button" onclick="location.href='{{ url_for('dashboard_page') }}'" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i> å–æ¶ˆ
                        </button>
                        <button id="createBtn" type="submit" class="btn btn-primary fw-bold">
                            <i class="fas fa-check me-1"></i> å»ºç«‹è¡¨å–®
                        </button>
                    </div>

                </form> 
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script src="{{ url_for('static', filename='api.js') }}"></script>
    
    <script>
        const owner_id = localStorage.getItem("user_id");
        const owner_email = localStorage.getItem("email");

        document.getElementById("createForm").addEventListener("submit", async (e) => {
            e.preventDefault(); 

            const title = document.getElementById("title").value.trim();
            const description = document.getElementById("description").value.trim();

            if(!title) return alert("è«‹è¼¸å…¥è¡¨å–®åç¨±");

            const fields = {
                remittance: document.getElementById("f_remittance").checked,
                shipped: document.getElementById("f_shipped").checked,
                shipping_fee: document.getElementById("f_shipping_fee").checked,
                merge_shipping: document.getElementById("f_merge_shipping").checked,
                buyer_social: document.getElementById("f_buyer_social").checked
            };

            // ç¦ç”¨æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
            const createBtn = document.getElementById("createBtn");
            createBtn.disabled = true;
            createBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> å»ºç«‹ä¸­...';


            const res = await apiCreateForm(owner_id, owner_email, title, description, fields);

            if(res.success){
                alert("è¡¨å–®å»ºç«‹æˆåŠŸï¼ç¾åœ¨å°‡å°å‘å„€è¡¨æ¿ã€‚");
                // é€™è£¡ä¹Ÿä¿®æ­£ï¼šç¢ºä¿è·³è½‰ URL è¢«é›™å¼•è™ŸåŒ…åœ
                location.href = "{{ url_for('dashboard_page') }}"; 
            } else {
                alert("å»ºç«‹å¤±æ•—ï¼š" + (res.message || "æœªçŸ¥éŒ¯èª¤"));
                createBtn.disabled = false; // å¤±æ•—å¾Œé‡æ–°å•Ÿç”¨æŒ‰éˆ•
                createBtn.innerHTML = '<i class="fas fa-check me-1"></i> å»ºç«‹è¡¨å–®';
            }
        });
    </script>

</body>
</html>